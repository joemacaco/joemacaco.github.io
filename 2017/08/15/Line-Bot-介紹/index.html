<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Line Bot 介紹 · Blog</title><meta name="description" content="Line Bot 介紹 - Joe Ma"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.joemacaco.idv.tw/atom.xml" title="Blog"></head><body><div class="progress-bar-container"><div class="progress-bar"></div></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link"><i class="fa fa-home">BLOG</i></a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link"><i class="fa fa-list">ARCHIVE</i></a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link"><i class="fa fa-user">ABOUT</i></a></li><li class="nav-list-item"><a href="https://github.com/joemacaco" target="_blank" class="nav-list-link"><i class="fa fa-github-alt">GITHUB</i></a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Line Bot 介紹</h1><div class="post-info">2017年8月15日</div><div class="post-content"><div><i class="fa fa-tags"></i>標籤<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Line/">Line</a></li></ul></div><p>LINE BOT雖然已經推出很久了，不過一直沒有時間去玩玩看，所以今天就記錄一下摸索的過程。<br><img src="/blog/imgs/line-bot/MessagingAPI.png" alt="MessagingAPI"></p>
<h3 id="LINE-BOT-設定"><a href="#LINE-BOT-設定" class="headerlink" title="LINE BOT 設定"></a>LINE BOT 設定</h3><p>來到 <a href="https://business.line.me/zh-hant/" target="_blank" rel="external">LINE Business Center</a> 建立BOT帳號，先登入個人帳號</p>
<h4 id="新增帳號"><a href="#新增帳號" class="headerlink" title="新增帳號"></a>新增帳號</h4><p>選取 <code>新增公司/經營者</code><br><img src="/blog/imgs/line-bot/addNew.png" alt="addNewImg"></p>
<p>註冊基本資訊選取個人<br><img src="/blog/imgs/line-bot/register.png" alt="registerImg"></p>
<p>註冊完成後，開始使用服務，選用 <code>Messaging Api</code><br><img src="/blog/imgs/line-bot/startService.png" alt="startServiceImg"></p>
<p>選擇 <code>開始使用Developer Trial</code><br><img src="/blog/imgs/line-bot/MessagingAPIChoose.png" alt="MessagingAPIChooseImg"></p>
<p>上傳<code>帳號圖片</code>、並輸入<code>帳號名稱</code>選取<code>業種</code><br><img src="/blog/imgs/line-bot/botInitSet.png" alt="botInitSetImg"></p>
<p>申請完成的畫面<br><img src="/blog/imgs/line-bot/initSetSuccess.png" alt="initSetSuccessImg"></p>
<p>進入<code>LINE MANAGER</code> 點選 <code>開始使用API</code><br><img src="/blog/imgs/line-bot/botStart.png" alt="botStartImg"></p>
<h4 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h4><p>BOT請求設定，Webhook傳訊勾選啟用</p>
<p>選取LINE Developers取得 <code>Channel ID</code> <code>Channel Secret</code> <code>Channel Access Token</code><br><img src="/blog/imgs/line-bot/botOption.png" alt="botOptionImg"></p>
<h3 id="Webhook-URL-設定"><a href="#Webhook-URL-設定" class="headerlink" title="Webhook URL 設定"></a>Webhook URL 設定</h3><p>選擇使用node.js去建立<br>建議在往下操作前先了解Node.js</p>
<h4 id="初始安裝"><a href="#初始安裝" class="headerlink" title="初始安裝"></a>初始安裝</h4><p>建立初始化 <code>package.json</code> 檔案<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"lineChatBot"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"start"</span>: <span class="string">"node ."</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>安裝會使用到的套件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install linebot express --save</div></pre></td></tr></table></figure></p>
<h4 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h4><p>建立 <code>index.js</code> 檔案<br>填入一些個人linebot的基礎設定，<code>CHANNEL_ID</code>、<code>CHANNEL_SECRET</code>、<code>CHANNEL_ACCESS_TOKEN</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> linebot = <span class="built_in">require</span>(<span class="string">'linebot'</span>);</div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> bot = linebot(&#123;</div><div class="line">  <span class="attr">channelId</span>: CHANNEL_ID,</div><div class="line">  <span class="attr">channelSecret</span>: CHANNEL_SECRET,</div><div class="line">  <span class="attr">channelAccessToken</span>: CHANNEL_ACCESS_TOKEN</div><div class="line">&#125;);</div><div class="line"></div><div class="line">bot.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (event.message.type = <span class="string">'text'</span>) &#123;</div><div class="line">    <span class="keyword">var</span> msg = event.message.text;</div><div class="line">    event.reply(msg).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">      <span class="comment">// success </span></div><div class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">      <span class="comment">// error </span></div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> app = express();</div><div class="line"><span class="keyword">const</span> linebotParser = bot.parser();</div><div class="line">app.post(<span class="string">'/'</span>, linebotParser);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(process.env.PORT || <span class="number">8080</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> port = server.address().port;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="Heroku-設定與佈署"><a href="#Heroku-設定與佈署" class="headerlink" title="Heroku 設定與佈署"></a>Heroku 設定與佈署</h3><p>因為LINE BOT的Webhook URL有限定需要https所以才會選擇使用Heroku<br>先建立<a href="https://dashboard.heroku.com/" target="_blank" rel="external">Heroku</a>帳號</p>
<h4 id="佈署"><a href="#佈署" class="headerlink" title="佈署"></a>佈署</h4><p><code>New</code>裡面選取<code>Create new app</code><br>將程式碼佈署上去<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git remote add heroku https://git.heroku.com/app_name.git</div><div class="line">$ git push heroku master</div></pre></td></tr></table></figure></p>
<p>選取More選單底下的View logs可以看到，代表server已經運作<br><img src="/blog/imgs/line-bot/herokuServerUp.png" alt="herokuServerUpImg"></p>
<h4 id="設定-1"><a href="#設定-1" class="headerlink" title="設定"></a>設定</h4><p>設定Config Variables，填上LINE BOT的<code>ChannelSecret</code>和<code>ChannelAccessToken</code><br><img src="/blog/imgs/line-bot/herokuSet.png" alt="herokuSetImg"></p>
<p>完成後在LINE BOT設定Webhook URL，並按下VERIFY如果出現Success就代表成功<br><img src="/blog/imgs/line-bot/webhookURL.png" alt="webhookURLImg"></p>
<h3 id="LINE-BOT-測試"><a href="#LINE-BOT-測試" class="headerlink" title="LINE BOT 測試"></a>LINE BOT 測試</h3><p>透過QRCode加入好友後，可開始聊天，目前是會將訊息重新回傳給使用者<br><img src="/blog/imgs/line-bot/line-bot.jpg" alt="lineBotImg"></p>
<p>在Heroku則可以看到底下的Log訊息<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'message'</span>,</div><div class="line">  <span class="attr">replyToken</span>: <span class="string">'xxxxxx'</span>,</div><div class="line">  <span class="attr">source</span>:</div><div class="line">  &#123;</div><div class="line">    <span class="attr">userId</span>: <span class="string">'xxxxxx'</span>,</div><div class="line">    <span class="attr">type</span>: <span class="string">'user'</span>,</div><div class="line">    <span class="attr">profile</span>: [<span class="built_in">Function</span>]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">timestamp</span>: <span class="number">1502799858530</span>,</div><div class="line">  <span class="attr">message</span>:</div><div class="line">  &#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'text'</span>,</div><div class="line">    <span class="attr">id</span>: <span class="string">'xxx'</span>,</div><div class="line">    <span class="attr">text</span>: <span class="string">'測試'</span>,</div><div class="line">    <span class="attr">content</span>: [<span class="built_in">Function</span>]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">reply</span>: [<span class="built_in">Function</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="參考連結"><a href="#參考連結" class="headerlink" title="參考連結"></a>參考連結</h3><ul>
<li><a href="https://www.npmjs.com/package/linebot" target="_blank" rel="external">linebot</a></li>
<li><a href="https://www.npmjs.com/package/express" target="_blank" rel="external">express</a></li>
<li><a href="https://dashboard.heroku.com/" target="_blank" rel="external">heroku</a></li>
<li><a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction" target="_blank" rel="external">heroku-getting-started-with-nodejs</a></li>
<li><a href="https://stackoverflow.com/questions/18008620/node-js-express-js-app-only-works-on-port-3000" target="_blank" rel="external">node-js-express-js-app-works-on-custom-port</a></li>
<li><a href="http://www.oxxostudio.tw/articles/201701/line-bot.html" target="_blank" rel="external">LINE BOT 實戰</a></li>
</ul></div></article></div><div class="sidebar"><div class="toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#LINE-BOT-設定"><span class="toc-text">LINE BOT 設定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#新增帳號"><span class="toc-text">新增帳號</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#設定"><span class="toc-text">設定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webhook-URL-設定"><span class="toc-text">Webhook URL 設定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#初始安裝"><span class="toc-text">初始安裝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#程式碼"><span class="toc-text">程式碼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Heroku-設定與佈署"><span class="toc-text">Heroku 設定與佈署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#佈署"><span class="toc-text">佈署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#設定-1"><span class="toc-text">設定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LINE-BOT-測試"><span class="toc-text">LINE BOT 測試</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#參考連結"><span class="toc-text">參考連結</span></a></li></ol></div></div></main><footer><div class="paginator"><a href="/2017/08/12/React-學習資源整合/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'joemacaco';
var disqus_identifier = '2017/08/15/Line-Bot-介紹/';
var disqus_title = 'Line Bot 介紹';
var disqus_url = 'http://blog.joemacaco.idv.tw/2017/08/15/Line-Bot-介紹/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//joemacaco.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2017 <a href="http://blog.joemacaco.idv.tw">Joe Ma</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div><div class="totop"><i class="fa fa-2x fa-chevron-circle-up"></i></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><link href="/blog/css/font-awesome.min.css" rel="stylesheet"><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-78758976-1",'auto');ga('send','pageview');</script></body></html>